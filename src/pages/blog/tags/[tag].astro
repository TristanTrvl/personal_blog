---
import Layout from "@layouts/Default.astro";
import BlogList from "@components/blog/BlogList.astro";

import type { CollectionEntry } from "astro:content";
import { getCollection } from "astro:content";

export async function getStaticPaths() {
	const allPosts = await getCollection("blog").then((collection) => {
		return collection.sort(
			(a, b) => b.data.pubDate.getTime() - a.data.pubDate.getTime(),
		);
	});

	const tags: string[] = [];

	allPosts.forEach((post) => {
		post.data.tags.forEach((tag) => {
			tags.push(tag.toLowerCase());
		});
	});

	return Array.from(new Set(tags)).map((tag) => {
		return {
			params: { tag },
			props: {
				tag,
				blogposts: allPosts.filter((post) =>
					post.data.tags.map((tag) => tag.toLowerCase()).includes(tag),
				),
			},
		};
	});
}

export interface Props {
	tag: string;
	blogposts: CollectionEntry<"blog">[];
}

const { tag, blogposts } = Astro.props;
---

<Layout
	title={`Blog: ${tag}`}
	description={`Tristan Thoraval Blog | All posts tagged with ${tag}`}
	pageTitle={`Tristan Thoraval | Blogposts tagged with ${tag}`}
>
	<main class="main-grid">
		<aside class="laside">
      <nav basics-sidenote="">
        <a basics-link="" href="/blog">
        <div>
          <span basics-text=""><em>&larr;Back to blog</em></span>
        </div>
        </a>
      </nav>
		</aside>
		<BlogList posts={blogposts} />
	</main>
</Layout>